## 메모리란 뭘까?

<aside>

**R**andom **A**ccess **M**emory의 약자로,
> 컴퓨터가 켜지는 순간부터 CPU는 연산을 하고 동작에 필요한 모든 내용이 전원이 유지되는 내내 이 기억장치에 저장된다.
> '주기억장치'로 분류되며 보통 램이 많으면 한번에 많은 일을 할 수 있기에 '책상'에 비유되곤 한다. 책상이 넓으면 그 위에 여러가지 물품을 올려놓을 수 있고, 이후 그 물품을 다시 회수하면 그 물품이 있었다는 기록은 사라지기 때문이다.

</aside>

## 메모리 구조


<aside>

> 운영체제는 메모리(RAM)에 프로그램을 위한 공간을 할당해준다.
> 메모리의 공간은 총 4가지(Code, Data, Heap, Stack)로 나눠져있다.

</aside>

### 1. 코드 영역

- 우리가 작성한 소스 코드가 기계어 형태(`0, 1`)로 저장됨
- CPU는 이 코드 영역에 저장된 명령어들을 하나씩 가져가서 실행함

### 2. 데이터 영역

- 전역 변수와 정적 *변수(static)이 할당되는 영역
    - 정적 변수(static)이란?
        
        클래스 및 구조체 내에서 선언하기 때문에 특정 타입 내부에 국한된다.
        따라서, 전역 변수와 다르게 정적 변수가 선언된 특정 타입이 메모리에 로드 될때 할당된다.
        또한, Swift에서는 기본동작이 `lazy`이기 때문에 해당 값에 처음 접근해야 초기화가 된다.
        
- 프로그램이 시작과 동시에 할당되고 프로그램이 종료되어야 메모리가 해제됨

```swift
// 전역 변수
var name: String?

struct Korean {
	// 정적 변수
	static let country = "Korea"
}
```

### 3. 힙 영역

- 프로그래머가 할당/해제하는 메모리 영역
- `malloc`, `calloc`으로 힙에 메모리를 할당 할 수 있음(`= 동적할당`)
- 사용하고 난 후에는 반드시 메모리 해제를 해줘야 함
- 나머지 영역 중 유일하게 런타임 시에 결정되기 때문에 데이터의 크기가 확실하지 않을 때 사용함
- Swift에서는 ARC를 통해 힙에 할당된 메모리가 더 이상 쓸모 없어지면 자동으로 해제함
- 인스턴스, 클로저 등등 참조 타입(Referece Type)은 자동으로 힙에 할당함

### 4. 스택 영역

- 프로그램이 자동으로 사용하는 임시 메모리 영역
- 함수 호출 시 생성되는 지역변수와 매개 변수를 저장함
- 함수 호출이 완료되면 저장된 메모리를 해제 함
- Last in First Out

```swift
func add(a: Int, b: Int) -> Int { // a, b 스택에 할당
	let result = a + b // result 스택에 할당
	return result
}

// 다쓰면 메모리 해제
```

## 참고

- https://namu.wiki/w/RAM
- https://babbab2.tistory.com/25
- https://velog.io/@shindoyeon/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B5%AC%EC%A1%B0